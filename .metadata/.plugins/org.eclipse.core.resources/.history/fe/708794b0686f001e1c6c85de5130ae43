#include <IfxCpu.h>
#include <IfxScuWdt.h>
#include <Platform_Types.h>
#include "LQ_CCU6.h"


#include "src/Mycode/My_Camera.h"
#include "src/APP/LQ_TFT18.h"
#include "src/MyCode/MyMPU6050.h"
#include <stdio.h>
#include "src/Main/Main.h"
#include "LQ_CAMERA.h"

#pragma section all "cpu1_dsram"

char k0,k1;
float PIDParam;
char txt2[16];

void Key_GetVal(void);

int core1_main ()
{
    IfxCpu_enableInterrupts();
    IfxScuWdt_disableCpuWatchdog (IfxScuWdt_getCpuWatchdogPassword ());
    while(!IfxCpu_acquireMutex(&mutexCpu0InitIsOk));
//#################################################################################################
//#################################################################################################
//#################################################################################################
//
//
    TFTSPI_Init(0);        //LCD初始化  0:横屏  1：竖屏
    TFTSPI_CLS(u16BLUE);   //蓝色屏幕

    CCU6_InitConfig(CCU61, CCU6_Channel1, 2000);//定时器中断2ms
    CCU6_EnableInterrupt(CCU61,CCU6_Channel1);//中断使能

    CAMERA_Init(60);
    PIDParam = -50;
    while(1)//主循环
    {
        My_Camera();
        sprintf(txt2, "%.2f",PIDParam);
        TFTSPI_P8X16Str(1, 7, txt2, u16WHITE, u16BLACK);
        Key_GetVal();
    }
    return 0;
}

void Key_GetVal(void)
{
    k0 = KEY_Read(KEY0);
    k1 = KEY_Read(KEY1);
    if(k0==0)
    {
        PIDParam += 1;
    }
    if(k1==0)
    {
        PIDParam -= 1;
    }
}

void CCU61_CH1_IRQHandler (void)
{
    /* 开启CPU中断  否则中断不可嵌套 */
    IfxCpu_enableInterrupts();

    // 清除中断标志
    IfxCcu6_clearInterruptStatusFlag(&MODULE_CCU61, IfxCcu6_InterruptSource_t13PeriodMatch);

    Image();
}


#pragma section all restore
